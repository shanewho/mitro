(function(){function h(f){f.tls.wrapSocket=function(c){var a=c.socket,e={id:a.id,connected:a.connected||function(b){},closed:a.closed||function(b){},data:a.data||function(b){},error:a.error||function(b){}},d=f.tls.createConnection({server:!1,sessionId:c.sessionId||null,caStore:c.caStore||[],sessionCache:c.sessionCache||null,cipherSuites:c.cipherSuites||null,virtualHost:c.virtualHost,verify:c.verify,getCertificate:c.getCertificate,getPrivateKey:c.getPrivateKey,getSignature:c.getSignature,deflate:c.deflate,
inflate:c.inflate,connected:function(b){1===b.handshakes&&e.connected({id:a.id,type:"connect",bytesAvailable:b.data.length()})},tlsDataReady:function(b){return a.send(b.tlsData.getBytes())},dataReady:function(b){e.data({id:a.id,type:"socketData",bytesAvailable:b.data.length()})},closed:function(b){a.close()},error:function(b,c){e.error({id:a.id,type:"tlsError",message:c.message,bytesAvailable:0,error:c});a.close()}});a.connected=function(b){d.handshake(c.sessionId)};a.closed=function(b){d.open&&d.handshaking&&
e.error({id:a.id,type:"ioError",message:"Connection closed during handshake.",bytesAvailable:0});d.close();e.closed({id:a.id,type:"close",bytesAvailable:0})};a.error=function(b){e.error({id:a.id,type:b.type,message:b.message,bytesAvailable:0});d.close()};var g=0;a.data=function(b){d.open?b.bytesAvailable>=g&&(b=Math.max(b.bytesAvailable,g),b=a.receive(b),null!==b&&(g=d.process(b))):a.receive(b.bytesAvailable)};e.destroy=function(){a.destroy()};e.setSessionCache=function(b){d.sessionCache=tls.createSessionCache(b)};
e.connect=function(b){a.connect(b)};e.close=function(){d.close()};e.isConnected=function(){return d.isConnected&&a.isConnected()};e.send=function(b){return d.prepare(b)};e.receive=function(b){return d.data.getBytes(b)};e.bytesAvailable=function(){return d.data.length()};return e}}if("function"!==typeof define)if("object"===typeof module&&module.exports){var m=!0;define=function(f,c){c(require,module)}}else return"undefined"===typeof forge&&(forge={}),h(forge);var k,n=function(f,c){c.exports=function(a){var c=
k.map(function(a){return f(a)}).concat(h);a=a||{};a.defined=a.defined||{};if(a.defined.tlssocket)return a.tlssocket;a.defined.tlssocket=!0;for(var d=0;d<c.length;++d)c[d](a);return a.tlssocket}},l=define;define=function(f,c){k="string"===typeof f?c.slice(2):f.slice(2);if(m)return delete define,l.apply(null,Array.prototype.slice.call(arguments,0));define=l;return define.apply(null,Array.prototype.slice.call(arguments,0))};define(["require","module","./tls"],function(){n.apply(null,Array.prototype.slice.call(arguments,
0))})})();
