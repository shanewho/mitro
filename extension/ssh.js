(function(){function p(c){function f(a,e){var d=e.toString(16);"8"<=d[0]&&(d="00"+d);d=c.util.hexToBytes(d);a.putInt32(d.length);a.putBytes(d)}function g(a,c){a.putInt32(c.length);a.putString(c)}function n(){for(var a=c.md.sha1.create(),e=arguments.length,d=0;d<e;++d)a.update(arguments[d]);return a.digest()}var l=c.ssh=c.ssh||{};l.privateKeyToPutty=function(a,e,d){d=d||"";e=e||"";var l=""===e?"none":"aes256-cbc",k;k="PuTTY-User-Key-File-2: ssh-rsa\r\n"+("Encryption: "+l+"\r\n")+("Comment: "+d+"\r\n");
var m=c.util.createBuffer();g(m,"ssh-rsa");f(m,a.e);f(m,a.n);var h=c.util.encode64(m.bytes(),64),b=Math.floor(h.length/66)+1;k+="Public-Lines: "+b+"\r\n";k+=h;h=c.util.createBuffer();f(h,a.d);f(h,a.p);f(h,a.q);f(h,a.qInv);e?(b=h.length()+16-1,b-=b%16,a=n(h.bytes()),a.truncate(a.length()-b+h.length()),h.putBuffer(a),b=c.util.createBuffer(),b.putBuffer(n("\x00\x00\x00\x00",e)),b.putBuffer(n("\x00\x00\x00\u0001",e)),b=c.aes.createEncryptionCipher(b.truncate(8),"CBC"),b.start(c.util.createBuffer().fillWithByte(0,
16)),b.update(h.copy()),b.finish(),b=b.output,b.truncate(16),a=c.util.encode64(b.bytes(),64)):a=c.util.encode64(h.bytes(),64);b=Math.floor(a.length/66)+1;k+="\r\nPrivate-Lines: "+b+"\r\n";k+=a;e=n("putty-private-key-file-mac-key",e);b=c.util.createBuffer();g(b,"ssh-rsa");g(b,l);g(b,d);b.putInt32(m.length());b.putBuffer(m);b.putInt32(h.length());b.putBuffer(h);d=c.hmac.create();d.start("sha1",e);d.update(b.bytes());return k+="\r\nPrivate-MAC: "+d.digest().toHex()+"\r\n"};l.publicKeyToOpenSSH=function(a,
e){e=e||"";var d=c.util.createBuffer();g(d,"ssh-rsa");f(d,a.e);f(d,a.n);return"ssh-rsa "+c.util.encode64(d.bytes())+" "+e};l.privateKeyToOpenSSH=function(a,e){return e?c.pki.encryptRsaPrivateKey(a,e,{legacy:!0,algorithm:"aes128"}):c.pki.privateKeyToPem(a)}}if("function"!==typeof define)if("object"===typeof module&&module.exports){var s=!0;define=function(c,f){f(require,module)}}else return"undefined"===typeof forge&&(forge={}),p(forge);var q,t=function(c,f){f.exports=function(g){var f=q.map(function(a){return c(a)}).concat(p);
g=g||{};g.defined=g.defined||{};if(g.defined.ssh)return g.ssh;g.defined.ssh=!0;for(var l=0;l<f.length;++l)f[l](g);return g.ssh}},r=define;define=function(c,f){q="string"===typeof c?f.slice(2):c.slice(2);if(s)return delete define,r.apply(null,Array.prototype.slice.call(arguments,0));define=r;return define.apply(null,Array.prototype.slice.call(arguments,0))};define("require module ./util ./sha1 ./aes ./hmac".split(" "),function(){t.apply(null,Array.prototype.slice.call(arguments,0))})})();
