var background=background||null,kew=kew||require("../../../../api/js/cli/kew"),exportsecrets={};
(function(){exportsecrets.ExportedSecret=function(){this.title=this.url=this.note=this.password=this.username=null};var f=function(a){return null===a||void 0===a?"":a};exportsecrets.convertToLastPassCSVArray=function(a){var b=[];b.push("url username password extra name grouping fav".split(" "));for(var d=0;d<a.length;d++){var e=a[d],c=[],g="";e.note&&!e.url&&(e.url="http://sn",g="Secure Notes");c.push(f(e.url));c.push(f(e.username));c.push(f(e.password));c.push(f(e.note));c.push(f(e.title));c.push(g);
c.push("0");b.push(c)}return b};var h=function(a){var b=new kew.Promise;background.getSiteSecretDataForDisplay(a,function(d){var a=null,a=d.criticalData.note?d.criticalData.note:d.clientData.comment,c=new exportsecrets.ExportedSecret;c.username=d.clientData.username;c.password=d.criticalData.password;c.note=a;c.url=d.clientData.loginUrl;c.title=d.clientData.title;b.resolve(c)},function(a){b.reject(a)});return b},k=function(){var a=new kew.Promise;background.fetchServices(function(b){a.resolve(b)},
function(b){a.reject(b)});return a},l=function(){var a=new kew.Promise;background.getOrganizationInfo(function(b){var d={},e;for(e in b.organizations)b.organizations[parseInt(e,10)]&&(d[e]=!0);a.resolve(d)},function(b){a.reject(b)});return a};exportsecrets.fetchServicesForExport=function(){var a=k(),b=l();return kew.all([a,b]).then(function(a){var b=a[0];a=a[1];for(var c=[],g=0;g<b.length;g++){var f=b[g];f.owningOrgId?a[f.owningOrgId]&&c.push(f):c.push(f)}return c})};var m=function(a){return function(b){return h(a).then(function(a){b.push(a);
return b})}};exportsecrets.exportAllSecretsPromise=function(){return exportsecrets.fetchServicesForExport().then(function(a){for(var b=new kew.Promise,d=b,e=0;e<a.length;e++)var c=m(a[e].secretId),d=d.then(c);b.resolve([]);return d})};exportsecrets.setBackgroundForTest=function(a){background=a};"undefined"!==typeof module&&module.exports&&(module.exports=exportsecrets)})();
