$(document).ready(function(){var f=null,g={},h=showSpinny($(".spinny"));registerLiveSearch($("#member-filter-string"),".member");mitro.loadOrganizationInfo(function(a){a=a.getSelectedOrganization();f=a.id;background.getOrganization(a.id,function(a){var b,e={};for(b=0;b<a.admins.length;b++)e[a.admins[b]]=1;a.members.sort();var d=[];for(b=0;b<a.members.length;b++){var f=a.members[b];d.push({name:f,admin:e.hasOwnProperty(f)})}hideSpinny($(".spinny"),h);for(a=0;a<d.length;a++)b=d[a],b.id=b.name,b.accessLevel=
b.admin?"Admin":"User";$(".users-list").html(templates["members-template"].render({users:d}));replaceBlankImages($(".member-icon"));g=createMapFromArrayOnAttribute(d,"id")},onBackgroundError)},onBackgroundError);$("#show-invite-members-button").click(function(){resetAndShowModal($("#invite-members-modal"))});$("#invite-members-button").click(function(){for(var a=$("#invite-members-modal form"),c=a.find('input[name="emails"]').val().split(","),b=[],e=0;e<c.length;e++){var d=c[e].trim();if(d){if(!validateEmail(d))return showErrorDialog("Invalid email address: "+
d),!1;b.push(d)}}if(0===b.length)return showErrorDialog("Please enter an email address"),!1;a.find('textarea[name="message"]').val();background.mutateOrganization(f,[],b,[],[],reload,onBackgroundError)});$(document).on("click",".user-access-level li",function(a){a=$(a.target).closest(".member");a=g[a.attr("data-username")];var c=$(this).text().toLowerCase();console.log("changing access level of user "+a.name+" to "+c);var b=[],e=[];"admin"===c?b.push(a.name):e.push(a.name);background.mutateOrganization(f,
b,[],e,[],reload,onBackgroundError);showSpinny($(".spinny"))});$(document).on("click",".remove-user",function(a){a=$(a.target).closest(".member");a=g[a.attr("data-username")];var c="Remove "+a.name+" from organization?",b=$("#delete-confirm-modal");b.find(".delete-message").text(c);c=b.find('input[name="email"]');c.val(a.name);c.data("is-admin",a.admin);b.modal("show");return!1});$("#remove-user-button").click(function(a){var c=$(a.target).closest(".modal").find('input[name="email"]');a=c.val();c=
c.data("is-admin");console.log("removing user",a,"from org; is admin?",c);var b=[];c&&b.push(a);background.mutateOrganization(f,[],[],b,[a],reload,onBackgroundError);showSpinny($(".spinny"))})});
