$(document).ready(function(){mitro.importer.attachEventHandlers(handleFileSelect)});function handleFileSelect(a){a=a.target.files[0];var b=new FileReader;if(!a.name.match(".xml"))throw alert("Currently the tool only supports xml uploads."),Error("Unsupported file type");b.onload=function(a){return function(a){a=parseXML(a.target.result);appendPasswordsToPage(a)}}(a);b.readAsText(a,"UTF-8");$("#password-list").html("");$("#upload-progress").empty();passwords=[]}
function parseXML(a){$("#password-list").empty();a=$($.parseXML(a));var b=parseKeepassVersion2x(a);return 0!==b.length?b:b=parseKeepassVersion1x(a)}
function parseKeepassVersion2x(a){var b=[],d=[];$("Entry",a).each(function(){var a=[];$("Key",this).each(function(){a.push(this.textContent)});d.push(a)});$("Entry",a).each(function(){var a=[];$("Value",this).each(function(){a.push(this.textContent)});b.push(a)});a=[];for(var c=0;c<b.length;c++){var e=b[c][d[c].indexOf("UserName")],f=b[c][d[c].indexOf("Password")],g=b[c][d[c].indexOf("URL")],h=b[c][d[c].indexOf("Title")];a.push(new Password(e,f,g,h,""))}return a}
function parseKeepassVersion1x(a){var b=[];$("pwentry,entry",a).each(function(a,c){var e=$("username",c).text(),f=$("password",c).text(),g=$("title",c).text(),h=$("url",c).text();b.push(new Password(e,f,h,g,""))});return b};
