var SecretAction={SIGN_IN:{action:0,label:"Sign in",image:"../img/key.png"},VIEW:{action:1,label:"View",image:"../img/eye.png"},COPY:{action:2,label:"Copy",image:"../img/eye.png"}},getRenderedTitle=function(a){var b="";a.clientData&&null!==a.clientData.title&&void 0!==a.clientData.title?b=a.clientData.title:a.hints&&a.hints.title?b=a.hints.title:a.clientData&&(b=getCanonicalHost(a.clientData.loginUrl)||"");return b},processServiceInstanceForRendering=function(a){var b=a.clientData;"loginUrl"in b&&
(a.host=getCanonicalHost(b.loginUrl));a.host?a.linkClass="icon-link":(a.linkClass="hide",a.host="");a.icon=a.hints&&a.hints.icons&&a.hints.icons.length?a.hints.icons[0]:EMPTY_IMAGE;a.renderedTitle=getRenderedTitle(a);"undefined"===typeof b.type&&(b.type="auto");b="auto"===a.clientData.type||"manual"===a.clientData.type&&a.clientData.username&&a.clientData.loginUrl&&0===a.clientData.loginUrl.indexOf("http")?SecretAction.SIGN_IN:SecretAction.VIEW;a.action=b.action;a.buttonLabel=b.label;a.buttonImage=
b.image;a.flattenedUsersForDisplay=a.flattenedUsers.slice(0,5);a.flattenedUsersForDisplayCount=-a.flattenedUsersForDisplay.length+a.flattenedUsers.length},disambiguateTitles=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c].renderedTitle;d in b?b[d]++:b[d]=1}for(c=0;c<a.length;c++){var e=a[c],d=e.renderedTitle;1<b[d]&&"username"in e.clientData&&(e.renderedTitle=d+" ("+e.clientData.username+")")}},secretSortFunc=function(a,b){return lowercaseCompare(a.renderedTitle?a.renderedTitle:"",b.renderedTitle?
b.renderedTitle:"")},renderServiceList=function(a,b,c){a.sort(secretSortFunc);disambiguateTitles(a);b.html(templates[c].render({secrets:a}));replaceBlankImages($(".service-icon"))},filterSecrets=function(a){var b=$(".list-item");a=a.toLocaleLowerCase();for(var c=0;c<b.length;++c){var d=$(b[c]),e;(e=!a)||(e=a,e=0<=d.find(".host,.title").text().toLocaleLowerCase().indexOf(e));e?(d.attr("data-matches",!0),d.show()):(d.attr("data-matches",!1),d.hide())}},openManageSecretPage=function(a){a="admin-manage-secret.html?secretId="+
a.secretId;-1!=window.location.href.indexOf("popup.html")?helper.tabs.create({url:helper.getURL("html/"+a)},function(a){console.log("opened tab")}):helper.setLocation(a)},copyText=function(a,b){var c=$('<input type="text">');c.val(a);$("body").append(c);helper.copyFromInput(c,function(){c.remove();b&&b()})},copyPassword=function(a,b){console.log("copying password");background.getSiteSecretDataForDisplay(a.secretId,function(a){"note"===a.clientData.type?copyText(a.criticalData.note,b):copyText(a.criticalData.password,
b)},function(a){alert("Unknown error occurred: "+a)})},executeSecretAction=function(a,b){if(a.action===SecretAction.COPY.action)copyPassword(a,b);else if(a.action===SecretAction.VIEW.action)openManageSecretPage(a);else if(a.action===SecretAction.SIGN_IN.action)background.doExtensionLogin(a);else throw Error("Unknown action");};WEBPAGE&&$(function(){$("body").addClass("webpage")});
