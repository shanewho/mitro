$(function(){var f=chrome.extension.getBackgroundPage();f.getIdentity(function(g){var h=function(a,e){for(var b=$("<ul>"),c=0;c<a.length;++c){var d=$("<li>");d.text(a[c]);b.append(d)}b.appendTo(e)},k=function(a){for(var e in a){var b=a[e],c=null;switch(b.groupModification){case "IS_NEW":c=$("#new-org-groups");break;case "IS_DELETED":c=$("#del-org-groups");break;case "MEMBERSHIP_MODIFIED":c=$("#modified-org-groups");break;default:throw"unexpected type"+b.groupModification;}c.append(templates["admin-sync-group-template"].render(b))}};
f.getPendingGroupDiffs(g,function(a){if(0===a.newOrgMembers.length+a.deletedOrgMembers.length+Object.keys(a.diffs).length)$(".result").text("Your organization is up to date.");else{h(a.newOrgMembers,$("#new-members"));h(a.deletedOrgMembers,$("#del-members"));k(a.diffs);var e=a.syncNonce;$(".result").hide();$(".show-diffs").show();$("#sync-memberships").click(function(){var b=2*a.newOrgMembers.length+Object.keys(a.diffs).length,c=1===b,d=new Date;d.setSeconds(d.getSeconds()+10*b);$(".show-diffs").hide();
$(".result").show();$(".result").text("Updating data. We have to generate approximately "+b+" new key"+(c?"":"s")+", which is time consuming.\nWe expect this operation to be complete by "+d.toLocaleString());f.pregenerateKeys(b,function(){$(".result").text("Keys generated; updating server. This should not take long");f.commitPendingGroupDiffs(g,e,null,function(){$(".result").text("Operation completed successfully.")},function(a){$(".result").text("Error. Please try again "+JSON.stringify(a))})},function(a){$(".result").text("Error. Please try again "+
JSON.stringify(a))})})}},function(a){$(".result").text("Error: "+a.userVisibleError)})})});
