$(function(){background.fetchServices(function(a){_.each(a,processServiceInstanceForRendering);renderServiceList(a,$("#all-secrets"),"bulk-move-services-template")},onBackgroundError);background.listGroups(function(a){a=filterVisibleGroups(a);$("#acl-groups").html(templates["bulk-move-groups-template"].render({groups:a}))},onBackgroundError);var e=null;mitro.loadOrganizationInfo(function(a){if(a=a.getSelectedOrganization())e=a.id,$("#org-transfer").show(),$("#org-name").text(a.name)},onBackgroundError);
$("#commit-acls").click(function(){var a=$("#all-secrets").find("input[type=checkbox]:checked"),b,c=[];for(b=0;b<a.length;++b)c.push(parseInt($(a[b]).attr("data-secret-id"),10));var g=$("#transfer-to-my-org").is(":checked"),a=$("#acl-groups").find("input[type=checkbox]:checked"),d=[];for(b=0;b<a.length;++b)d.push(parseInt($(a[b]).attr("data-group-id"),10));if(confirm("I am about to OVERWRITE all access control lists for "+c.length+" secrets with the "+d.length+" groups which you selected. You CANNOT UNDO THIS OPERATION")){$("#everything").hide();
var f=function(){$("#messages").text("Updating data: "+c.length+" secrets remain.");var a=c.pop();a?background.editSiteShares(a,d,[],g?e:null,f,onBackgroundError):$("#messages").text("Done!")};f()}})});
