(function(){var e=null,b=null;$(document).ready(function(){var d=$(".share-list"),f=$('[data-pane="invite"]'),h=$("#invite-item"),k=f.find('input[name="email"]'),l=f.find('input[name="name"]'),m=f.find('input[name="message"]');$("#team-filter-string").keyup(function(a){a=$(this).val();$("#invite-item #invite-name").html(a)});$("#team-filter-clear").click(function(){$("#invite-item #invite-name").html("")});var n=function(){if(b){var a=b.makeSecretAclTemplateData();d.html(templates["popup-share-secret-template"].render(a));
replaceBlankImages($(".share-list .user-icon, .share-list .group-icon"));registerLiveSearch($("#team-filter-string"),".share-list > .item",$("#team-filter-clear"))}},p=function(a,c){null===b&&c.secretId===e&&(b=new SecretMutater(c,background,a),n(),h.removeClass("hide"))};helper.onPopupHidden(function(){null!==b&&b.saveChanges()});$(document).on("popup_pane_changed",function(a){var c=$(a.target);a=a.originalEvent.detail.newPane;var g=getSecretForItem(c);if("team"===a){if(null===b||g.secretId!==e)e=
g.secretId,b=null,d.empty(),h.addClass("hide"),renderActiveSecret(g,$('[data-pane="team"] .active-account')),mitro.loadUserDataAndSecret(e,p,onBackgroundError)}else"invite"===a?(c=c.find("#invite-name").text(),a=getSecretById(e),renderActiveSecret(a,f.find(".active-account")),k.val(c),l.val(""),m.val(""),$("#team-filter-clear").trigger("click")):null!==b&&b.saveChanges()});d.on("click",'[data-action="grant"]',function(){var a=$(this),c=a.parents(".item");a.attr("data-action","revoke");c.addClass("shared");
a.find(".icon-add").removeClass("icon-add").addClass("icon-check");a=a.closest(".item");b.addAclItem(a);$('<div class="item msg-item"><div class="success-msg">shared!</div></div>').hide().insertAfter(a).fadeTo(400,.95).delay(300).fadeOut(1600,function(){$(this).remove()});return!1});var q=function(a){$(this);a.find(".action a").attr("data-action","grant");a.find(".icon-check").removeClass("icon-check").addClass("icon-add");b.removeAclItem(a);return!1};d.on("click",'[data-action="revoke"]',function(){var a=
$(this),b=a.parents(".item").children(".overlay"),e=a.parents(".item"),d=!1;a.hasClass("confirm")&&(d=!0);a.toggleClass("confirm");b.toggleClass("hide");d&&(q(a.closest(".item")),e.removeClass("shared"));return!1});d.on("click",'[data-action="cancel-revoke"]',function(){var a=$(this).parents(".item");$('[data-action="revoke"]',a).toggleClass("confirm");$(".overlay",a).toggleClass("hide");return!1});$(".send-invite-button").click(function(){var a=k.val();l.val();m.val();validateEmail(a)&&(b.addUser(a),
openPane("team"),n())})})})();
