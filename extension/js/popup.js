var INITIAL_FOCUS_REMOVE_TABINDEX_DELAY_MS=750,POPUP_WIDTH=290,SERVICES_PATH="secrets.html";SAFARI&&safari.application&&safari.application.addEventListener("popover",function(){console.log("reloading");window.location.reload()},!0);
var popupInitialFocus=function(a){a.attr("tabindex","1");a.on("focus",function(){setTimeout(function(){"1"===a.attr("tabindex")&&a.removeAttr("tabindex")},INITIAL_FOCUS_REMOVE_TABINDEX_DELAY_MS)});setTimeout(function(){a.focus()},10)},updateLoginState=function(){background.getLoginState(function(a){var b=a.identity;if(a.attemptingLogin)$("#logging-in").removeClass("hide"),$("#logged-out").addClass("hide"),$("#logged-in").addClass("hide");else if(null===b)$("#logged-out").removeClass("hide"),$("#logged-in").addClass("hide"),
$("#logging-in").addClass("hide"),initLoginForm();else if(b.changePwd)a="#required=true",window.location.hash&&(a=window.location.hash),helper.tabs.create({url:helper.getURL("html/change-password.html"+a)});else if($(window).width()>POPUP_WIDTH&&!1===debugMode)helper.setLocation(SERVICES_PATH);else{var c=function(){$("#logged-out").addClass("hide");$("#logging-in").addClass("hide");$("#logged-in").removeClass("hide");popupInitialFocus($("#secret-filter-string"))};background.getServiceInstances(void 0,
function(a){helper.tabs.getSelected(function(b){if(b&&background.getServiceInstances){var f=getCanonicalHost(b.url);background.getServiceInstances(f,function(d){c();if(1<=d.length){for(var b=0,g=0;g<d.length;++g)if(d[g].mostRecent){b=g;break}d=d[b]}else d=null;b=$('[data-pane="secrets"] .active-account');d&&f?(b.removeClass("hide"),document.getElementById("no-account-banner").classList.add("hide"),renderActiveSecret(d,b)):(b.addClass("hide"),document.getElementById("no-account-banner").classList.remove("hide"),
$(".secrets .list").addClass("list-no-site"));populateServiceList(a)})}else WEBPAGE?window.location.href=helper.getURL("html/secrets.html"):(c(),populateServiceList(a))})})}},onBackgroundError)},openPane=function(a){var b=$("[data-pane]").not(".hide"),c=$('[data-pane="'+a+'"]');b.addClass("hide");c.removeClass("hide");$("[data-current-pane]").attr("data-current-pane",a);"invite"===a&&c.find("[data-open-pane].back").attr("data-open-pane",b.attr("data-pane"))};
$(document).ready(function(){$(".logout").click(function(){background.mitroLogout(updateLoginState,onBackgroundError)});updateLoginState();helper.runPopupActions();$(document).on("click","[data-open-pane]",function(){var a=$(this),b=a.attr("data-open-pane"),c={newPane:b,oldPane:$("[data-pane]").not(".hide").attr("data-pane")},e=document.createEvent("CustomEvent");e.initCustomEvent("popup_pane_changed",!0,!0,c);this.dispatchEvent(e);openPane(b);a.hasClass("toggle")&&(a.toggleClass("hide"),a.siblings().toggleClass("hide"));
return!1});$(".generate-password input").click(function(){$(this).select()});$(".icon-settings").click(function(){var a=$(this);a.hasClass("icon-settings")?(a.removeClass("icon-settings"),a.addClass("icon-secrets"),a.attr("data-open-pane-id","secrets")):(a.removeClass("icon-secrets"),a.addClass("icon-settings"),a.attr("data-open-pane-id","settings"))});var a=$("#wrap"),b=a.parents("html"),c=a.find("#logged-out"),h=c.find("#logo"),e=c.find("#mitro-login-form"),c=c.find(".sign-up"),f=e.find("#remind-alert");
$(window).width()>POPUP_WIDTH&&!1===debugMode&&(a.addClass("web-wrap"),b.addClass("web"),h.wrap('<header class="simple-header"></header>'),$("<h1>Sign In</h1>").insertAfter(h),c.insertAfter(e),c.find("a").removeAttr("target").removeClass("button"),c.prepend("Don't have an account?"),e.wrap('<div class="basic-form-container"></div>'),f.insertAfter(e.find(".actions .left")))});
