var helpers_background={};
(function(){var e;e="undefined"!==typeof module?require("../common/helpers_common"):window.helpers_common;var f=function(a){var b=new e.MitroTab(a.id);b.windowId=a.windowId;b.index=a.index;b.url=a.url;b.title=a.title;return b};helpers_background.BackgroundHelper=function(){this.getURL=getURL;this.storage=chrome.storage;this.ajax=e.ajax;this.cookies=chrome.cookies;this.setIcon=function(a){if(a.path){var b={};"19"in a.path&&(b["19"]=a.path["19"]);"38"in a.path&&(b["38"]=a.path["38"]);a.path=b}chrome.browserAction.setIcon(a)};
this.tabs={onUpdated:function(a){chrome.tabs.onUpdated.addListener(function(b,c,d){"complete"===c.status&&a(b)})},onRemoved:function(a){chrome.tabs.onRemoved.addListener(function(b,c,d){a(b)})},sendMessage:function(a,b){chrome.tabs.sendMessage(a,b)},create:chrome.tabs.create,remove:chrome.tabs.remove,getSelected:function(a){chrome.tabs.getSelected(null,function(b){a(f(b))})},getAll:function(a){chrome.tabs.query({},function(b){for(var c=[],d=0;d<b.length;d++)c.push(f(b[d]));a(c)})},setUrl:function(a,
b){chrome.tabs.update(a,{url:b})}};this.getClientIdentifier=function(){try{var a="extension:["+chrome.runtime.id+","+chrome.runtime.getManifest().version+"]"}catch(b){console.log("could not read chrome extension info"),a="unknown"}return a};this.addContextMenu=function(){chrome.contextMenus.create({id:"mitro_context_group",title:"Mitro",contexts:["selection"]});chrome.contextMenus.create({id:"save_secret",title:"Save selection as secure note",contexts:["selection"],onclick:function(){helper.tabs.getSelected(function(a){helper.tabs.sendMessage(a.id,
client.composeMessage("content","copySelection",{tabUrl:a.url}))})},parentId:"mitro_context_group"})};this.removeContextMenu=function(){chrome.contextMenus.remove("mitro_context_group")};this.bindClient=function(a){chrome.extension.onMessage.addListener(function(b,c,d){b.sender=c.tab;b.sendResponse=function(b){b=a.composeResponse(this,b);chrome.tabs.sendMessage(this.sender.id,b)};a.processIncoming(b)})}}})();
